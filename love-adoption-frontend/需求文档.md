# 爱心领养网站 - 需求文档

## 1. 引言

本文档旨在明确爱心领养网站的功能需求和用户角色。该网站旨在为用户提供一个浏览、申请领养小动物的平台，并为管理员提供管理动物、用户和领养申请的功能。前端将采用 HTML、CSS 和 JavaScript 技术栈进行开发。

## 2. 用户角色

系统包含以下主要用户角色：

* **普通用户 (User):**
    * 可以注册和登录系统。
    * 可以浏览可领养的小动物列表。
    * 可以查看小动物的详细信息。
    * 可以提交领养申请。
    * 可以查看和修改自己的个人信息（如头像、昵称、性别）。
    * 可以查看自己提交的领养申请的状态，并可以撤回“待审核”的申请。
* **管理员 (Administrator):**
    * 拥有普通用户的所有权限（通常不直接执行撤回申请等用户特定操作）。
    * 可以管理所有动物信息（增、删、改、查），管理员添加的动物默认为“可领养”状态。
    * 可以管理所有用户信息（增、删、改、查）。
    * 可以审核用户提交的领养申请（同意或拒绝）。

## 3. 功能需求

### 3.1 通用功能

* **用户注册与登录**
    * **描述:** 用户可以通过账户密码进行注册和登录。用户角色默认为 'user'。
    * **接口依赖:**
        * 用户注册: `POST /api/user/register`
        * 用户登录: `POST /api/user/login`
        * 用户登出: `POST /api/user/logout`
* **获取当前登录用户信息**
    * **描述:** 用户登录后，系统应能获取并展示当前用户的基本信息。
    * **接口依赖:** `GET /api/user/get/login`

### 3.2 普通用户功能

#### 3.2.1 浏览动物信息

* **浏览可领养动物列表 (分页)**
    * **描述:** 用户可以分页浏览系统中所有 `adoption_status` 为 `0` (可领养) 的动物列表。列表应支持按条件筛选（如物种、年龄、性别等）和排序。
    * **接口依赖:** `GET /api/animal/list/page`
        * 请求参数可包括: `adoption_status` (固定为 `0` 以筛选可领养动物), `age`, `breed`, `gender` (`male` / `female`), `species`, `current`, `pageSize`, `sortField`, `sortOrder` 等。
* **查看动物详细信息**
    * **描述:** 用户点击动物列表中的某个动物后，可以查看该动物的详细信息，包括名称、物种、品种、年龄、性别 (`male` / `female`)、健康状况、描述、图片等。
    * **接口依赖:** `GET /api/animal/get?id={id}`

#### 3.2.2 申请领养

* **提交领养申请**
    * **描述:** 用户在查看动物详细信息后，可以为该动物提交领养申请，需要填写申请理由。提交后申请状态 `status` 默认为 `0` (待审核)。
    * **接口依赖:** `POST /api/application/add`
        * 请求体包含: `animal_id`, `application_reason`, `user_id` (系统自动获取当前登录用户ID)。
* **查看我的领养申请**
    * **描述:** 用户可以查看自己提交的所有领养申请及其当前状态 (`0`：待审核，`1`：通过，`2`：拒绝，`3`：已撤回) 和管理员的审核意见。
    * **接口依赖:** `GET /api/application/list/page` 或 `GET /api/application/list`
        * 请求参数需包含当前用户的 `user_id` 进行筛选。
* **撤回领养申请**
    * **描述:** 用户可以撤回自己提交的、状态为 `0` (待审核) 的领养申请。撤回后，申请状态 `status` 更新为 `3` (已撤回)。
    * **接口依赖:** `POST /api/application/update`
        * 请求体包含: `id` (申请ID), `status` (更新为 `3`)。

#### 3.2.3 个人信息管理

* **查看个人信息**
    * **描述:** 用户可以查看自己的账户信息，包括头像、用户昵称、账号、性别等。
    * **接口依赖:** `GET /api/user/get/login` 或 `GET /api/user/get?id={id}`。
* **修改个人信息**
    * **描述:** 用户可以修改自己的部分个人信息，如头像、用户昵称、性别。
    * **接口依赖:** `POST /api/user/update`
        * 请求体包含: `id` (用户ID), `gender`, `userAvatar`, `userName` 等可修改字段。
    * **头像上传接口依赖:** `POST /api/admin/common/upload` (用于上传新的头像图片，获取图片URL后再通过 `POST /api/user/update` 更新 `userAvatar` 字段)。

### 3.3 管理员功能

管理员拥有所有普通用户功能（通常不直接执行用户特定的操作如“撤回我的申请”），并额外具备以下管理权限：

#### 3.3.1 动物信息管理

* **新增动物信息**
    * **描述:** 管理员可以直接添加新的动物信息，添加后动物 `adoption_status` 默认为 `0` (可领养) 并直接在用户浏览列表中展示。动物记录中应包含操作管理员的 `userId`。
    * **接口依赖:** `POST /api/animal/add`
        * 请求体包含: `adoption_status` (设置为 `0`), `age`, `breed`, `description`, `gender` (`male` / `female`), `health_status`, `image_url`, `name`, `species`, `userId` (记录操作的管理员ID，由后端根据当前登录管理员自动填充或前端传递)。
    * **动物图片上传接口依赖:** `POST /api/admin/common/upload`
* **查看所有动物列表 (分页)**
    * **描述:** 管理员可以分页查看系统内所有动物的信息，包括各种状态的动物 (`0`：可领养，`1`：已领养)。可以查看每个动物记录关联的 `userId` (管理员ID)。支持筛选和排序。
    * **接口依赖:** `GET /api/animal/list/page`
* **修改动物信息**
    * **描述:** 管理员可以修改系统中任何动物的详细信息。修改时，可考虑更新一个“最后修改者ID”字段（如果数据库有设计）。
    * **接口依赖:** `POST /api/animal/update`
        * 请求体包含动物的 `id` 及需要更新的字段。API 文档中的 `AnimalUpdateRequest` 也包含 `userId`，可用于记录最后修改的管理员ID。
* **删除动物信息 (软删除)**
    * **描述:** 管理员可以软删除系统中的动物信息 (通过设置 `deleted_at` 字段)。
    * **接口依赖:** `POST /api/animal/delete`
        * 请求体包含要删除动物的 `id`。

#### 3.3.2 用户信息管理

* **查看所有用户列表 (分页)**
    * **描述:** 管理员可以分页查看系统内所有用户的信息 (`userRole` 包括 'user' 和 'admin')。 支持筛选和排序。
    * **接口依赖:** `GET /api/user/list/page`
* **新增用户**
    * **描述:** 管理员可以手动添加新的用户账户。
    * **接口依赖:** `POST /api/user/add`
* **修改用户信息**
    * **描述:** 管理员可以修改系统中任何用户的账户信息（包括 `userRole`）。
    * **接口依赖:** `POST /api/user/update`
* **删除用户 (软删除)**
    * **描述:** 管理员可以软删除系统中的用户账户 (通过设置 `isDelete = 1`)。
    * **接口依赖:** `POST /api/user/delete`
        * 请求体包含要删除用户的 `id`。

#### 3.3.3 领养申请管理

* **查看所有领养申请列表 (分页)**
    * **描述:** 管理员可以分页查看系统内所有的领养申请，包括各种状态的申请 (`0`：待审核，`1`：通过，`2`：拒绝，`3`：已撤回)。支持按动物ID、用户ID、申请状态等进行筛选和排序。
    * **接口依赖:** `GET /api/application/list/page`
* **查看领养申请详情**
    * **描述:** 管理员可以查看某一领养申请的详细信息，包括申请人信息、申请的动物信息、申请理由等。
    * **接口依赖:** `GET /api/application/get?id={application_id}`
* **审核领养申请**
    * **描述:** 管理员可以对 `status` 为 `0` (“待审核”) 的领养申请进行操作：“同意”或“拒绝”。
        * **同意:** 更新申请 `status` 为 `1` (“已通过”)，并应将对应动物的 `adoption_status` 更新为 `1` (“已领养”)。
        * **拒绝:** 更新申请 `status` 为 `2` (“已拒绝”)，并可以填写 `review_comments` (审核备注)。
    * **接口依赖:** `POST /api/application/update`
        * 请求体包含: `id` (申请ID), `status` (新的申请状态 `1` 或 `2`), `review_comments` (审核备注), `reviewed_by` (当前管理员ID)。
        * **联动操作:** 同意申请后，需调用 `POST /api/animal/update` 将对应动物的 `adoption_status` 更新为 `1`。

### 3.4 文件上传功能 (通用)

* **描述:** 系统提供统一的文件上传接口，主要用于上传用户头像和动物图片。
* **接口依赖:** `POST /api/admin/common/upload`
    * 请求类型: `multipart/form-data`
    * 参数: `file`
    * 响应: 返回文件的URL或其他标识。

## 4. 非功能需求 (简要)

* **易用性:** 界面简洁直观，操作流程符合用户习惯。
* **安全性:** 用户密码需加密存储，关键操作需要权限验证。
* **性能:** 列表查询、信息加载等操作响应迅速。
* **可靠性:** 系统稳定运行，数据准确无误。

## 5. 待明确/讨论点 (已根据SQL和新需求更新)

* **`animal.adoption_status` 状态值:**
    * SQL 已定义: `0` 表示可领养，`1` 表示已领养。含义保持与 SQL 定义一致。
* **`animal` 表的 `userId` 字段:**
    * **已确认添加。** 此字段将用于记录**添加或最后修改该动物记录的管理员ID**。
    * API 文档中 `addAnimal` 接口的请求体 `AnimalAddRequest` 和 `updateAnimal` 接口的请求体 `AnimalUpdateRequest` 均包含 `userId` 字段，应确保该字段正确传递并存储操作的管理员ID。
    * 响应体 `Animal` 对象也包含 `userId` 字段，可用于展示相关管理员信息。
* **领养申请同意后的动物状态联动:** 领养申请被同意后，对应动物的 `adoption_status` 应更新为 `1` (已领养)。建议此联动操作由后端在更新申请状态为“已通过”时自动完成，以保证数据一致性。